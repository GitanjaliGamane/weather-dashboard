<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Live Weather Dashboard</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #141E30, #243B55);
            padding: 30px;
            color: white;
        }

        h1 {
            text-align: center;
        }

        .controls {
            text-align: center;
            margin-bottom: 25px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 15px;
        }

        svg {
            width: 100%;
            height: 300px;
        }

        .axis text {
            fill: white;
            font-size: 12px;
        }

        .axis path,
        .axis line {
            stroke: white;
        }

        .tooltip {
            position: absolute;
            background: white;
            color: black;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            opacity: 0;
        }

        .aqi-card {
            text-align: center;
        }

        .aqi-number {
            font-size: 70px;
            font-weight: bold;
            margin: 20px 0;
        }

        .aqi-status {
            font-size: 20px;
            font-weight: 600;
            padding: 6px 15px;
            border-radius: 20px;
            display: inline-block;
        }

        .aqi-advice {
            margin-top: 15px;
            font-size: 14px;
            opacity: 0.9;
        }

        /* ===== SUMMARY WRAPPER ===== */
        .summary-wrapper {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0 40px;
        }

        /* ===== SUMMARY CARD ===== */
        .summary-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 18px 20px;
            border-radius: 18px;
            background: rgba(255, 255, 255, 0.07);
            backdrop-filter: blur(12px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.25);
            transition: all 0.3s ease;
            cursor: default;
        }

        .summary-card:hover {
            transform: translateY(-6px);
            background: rgba(255, 255, 255, 0.15);
        }

        /* ICON STYLE */
        .summary-icon {
            font-size: 32px;
        }

        /* TEXT INFO */
        .summary-info span {
            font-size: 14px;
            opacity: 0.8;
        }

        .summary-info h2 {
            margin: 5px 0 0;
            font-size: 22px;
        }

        /* OPTIONAL COLOR ACCENTS */
        .summary-card.temp {
            border-left: 4px solid #ff4d4d;
        }

        .summary-card.humidity {
            border-left: 4px solid #4facfe;
        }

        .summary-card.rain {
            border-left: 4px solid #00c6ff;
        }

        .summary-card.aqi {
            border-left: 4px solid #ff9a00;
        }

        .summary-card.uv {
            border-left: 4px solid #ffd700;
        }

        /* MOBILE */
        @media (max-width: 768px) {
            .summary-wrapper {
                grid-template-columns: 1fr;
            }
        }

        /* ===== CONTROLS CONTAINER ===== */
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 35px;
            flex-wrap: wrap;
        }

        /* ===== SELECT DROPDOWN ===== */
        #citySelect {
            padding: 10px 18px;
            font-size: 15px;
            border-radius: 25px;
            border: none;
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            backdrop-filter: blur(8px);
            cursor: pointer;
            transition: 0.3s ease;
        }

        /* Dropdown option text (important for visibility) */
        #citySelect option {
            color: black;
        }

        /* Hover effect */
        #citySelect:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        /* ===== BUTTON STYLE ===== */
        #loadBtn {
            padding: 10px 22px;
            font-size: 15px;
            border-radius: 25px;
            border: none;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s ease;
        }

        /* Button hover animation */
        #loadBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        /* Button click effect */
        #loadBtn:active {
            transform: scale(0.97);
        }
    </style>
</head>

<body>

    <h1>üå¶Ô∏è Weather Dashboard</h1>

    <div class="controls">
        <select id="citySelect">
            <option>Mumbai</option>
            <option>Nashik</option>
            <option>Delhi</option>
            <option>Bengaluru</option>
            <option>Chennai</option>
            <option>Kolkata</option>
            <option>Hyderabad</option>
            <option>Pune</option>
            <option>Ahmedabad</option>
            <option>Jaipur</option>
            <option>Lucknow</option>
            <option>Chandigarh</option>

        </select>
        <button id="loadBtn">Load Weather</button>
    </div>
    <!-- ===== SUMMARY SECTION START ===== -->
    <div class="summary-wrapper">

        <div class="summary-card temp">
            <div class="summary-icon">üå°</div>
            <div class="summary-info">
                <span>Temperature</span>
                <h2 id="tempNow">--¬∞C</h2>
            </div>
        </div>

        <div class="summary-card humidity">
            <div class="summary-icon">üíß</div>
            <div class="summary-info">
                <span>Humidity</span>
                <h2 id="humidityNow">--%</h2>
            </div>
        </div>

        <div class="summary-card rain">
            <div class="summary-icon">üåß</div>
            <div class="summary-info">
                <span>Rain</span>
                <h2 id="rainNow">-- mm</h2>
            </div>
        </div>

        <div class="summary-card aqi">
            <div class="summary-icon">üå´</div>
            <div class="summary-info">
                <span>AQI</span>
                <h2 id="aqiNow">--</h2>
            </div>
        </div>

        <div class="summary-card uv">
            <div class="summary-icon">‚òÄ</div>
            <div class="summary-info">
                <span>UV Index</span>
                <h2 id="uvNow">--</h2>
            </div>
        </div>

    </div>
    <!-- ===== SUMMARY SECTION END ===== -->

    <div class="dashboard">
        <div class="card">
            <h3>Temperature Line</h3><svg id="lineChart"></svg>
        </div>
        <div class="card">
            <h3>Temperature Bar</h3><svg id="barChart"></svg>
        </div>
        <div class="card">
            <h3>Humidity Area</h3><svg id="areaChart"></svg>
        </div>
        <div class="card">
            <h3>Rainfall</h3><svg id="rainChart"></svg>
        </div>
        <div class="card">
            <h3>Wind Speed</h3><svg id="windChart"></svg>
        </div>
        <div class="card aqi-card">
            <h3>üå´ Air Quality Index (AQI)</h3>

            <div class="aqi-number" id="aqiValue">--</div>

            <div class="aqi-status" id="aqiText">Loading...</div>

            <p class="aqi-advice" id="aqiAdvice"></p>
        </div>


    </div>

    <div class="tooltip"></div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {

            const API_KEY = "c285175054fe82fc5a7279c586db7cda";
            const tooltip = d3.select(".tooltip");

            document.getElementById("loadBtn").addEventListener("click", loadWeather);

            function showTip(event, text) {
                tooltip.style("opacity", 1)
                    .html(text)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 20) + "px");
            }
            function hideTip() { tooltip.style("opacity", 0); }

            // Get Coordinates
            async function getCoordinates(city) {
                const res = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}`
                );
                const data = await res.json();
                return {
                    lat: data.coord.lat,
                    lon: data.coord.lon
                };
            }

            // Get AQI Data
            async function getAQI(lat, lon) {
                const res = await fetch(
                    `https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${API_KEY}`
                );
                const data = await res.json();
                return data.list[0].main.aqi; // AQI value 1-5
            }

            // Convert AQI to Text + Color
            function getAQIInfo(aqi) {
                switch (aqi) {
                    case 1:
                        return {
                            text: "Good",
                            color: "#00e400",
                            advice: "Air quality is excellent. No precautions needed."
                        };
                    case 2:
                        return {
                            text: "Fair",
                            color: "#ffff00",
                            advice: "Air quality is acceptable for most people."
                        };
                    case 3:
                        return {
                            text: "Moderate",
                            color: "#ff7e00",
                            advice: "Sensitive groups should limit outdoor activity."
                        };
                    case 4:
                        return {
                            text: "Poor",
                            color: "#ff0000",
                            advice: "Avoid outdoor activities if possible."
                        };
                    case 5:
                        return {
                            text: "Very Poor",
                            color: "#8f3f97",
                            advice: "Stay indoors and wear masks outside."
                        };
                    default:
                        return {
                            text: "Unknown",
                            color: "white",
                            advice: ""
                        };
                }
            }


            // Load AQI
            async function loadAQI(city) {
                try {
                    const coords = await getCoordinates(city);
                    const aqi = await getAQI(coords.lat, coords.lon);

                    const info = getAQIInfo(aqi);

                    document.getElementById("aqiValue").innerText = aqi;
                    document.getElementById("aqiText").innerText = info.text;
                    document.getElementById("aqiText").style.backgroundColor = info.color;
                    document.getElementById("aqiAdvice").innerText = info.advice;


                } catch (error) {
                    console.error("AQI Error:", error);
                    document.getElementById("aqiValue").innerText = "--";
                    document.getElementById("aqiText").innerText = "Unable to load AQI";
                }
            }


            function base(svgId) {
                const svg = d3.select(svgId);
                svg.selectAll("*").remove();

                const width = svg.node().clientWidth;
                const height = svg.node().clientHeight;

                const margin = { top: 30, right: 30, bottom: 40, left: 50 };

                const g = svg.append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                return {
                    g,
                    width: width - margin.left - margin.right,
                    height: height - margin.top - margin.bottom
                };
            }

            async function fetchWeather(city) {
                try {
                    const res = await fetch(
                        `https://api.openweathermap.org/data/2.5/forecast?q=${city}&units=metric&appid=${API_KEY}`
                    );

                    if (!res.ok) throw new Error("API error");

                    const json = await res.json();
                    const daily = json.list.filter((_, i) => i % 8 === 0).slice(0, 5);

                    return daily.map(d => ({
                        day: new Date(d.dt * 1000).toLocaleDateString("en-US", { weekday: "short" }),
                        temp: d.main.temp,
                        humidity: d.main.humidity,
                        rain: d.rain?.["3h"] || 0,
                        wind: d.wind.speed
                    }));

                } catch (e) {
                    alert("API Error: Check key or wait for activation.");
                    console.error(e);
                    return [];
                }
            }

            async function loadWeather() {
                const city = document.getElementById("citySelect").value;

                try {

                    /* -------- CURRENT WEATHER (for summary cards) -------- */
                    const currentRes = await fetch(
                        `https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&appid=${API_KEY}`
                    );

                    const currentData = await currentRes.json();

                    document.getElementById("tempNow").innerText =
                        Math.round(currentData.main.temp) + "¬∞C";

                    document.getElementById("humidityNow").innerText =
                        currentData.main.humidity + "%";

                    document.getElementById("rainNow").innerText =
                        (currentData.rain ? currentData.rain["1h"] || 0 : 0) + " mm";

                    /* Fake UV (free API does not give UV in this endpoint) */
                    document.getElementById("uvNow").innerText =
                        Math.floor(Math.random() * 11);


                    /* -------- FORECAST (for charts) -------- */
                    const data = await fetchWeather(city);
                    if (data.length !== 0) {
                        drawCharts(data);
                    }

                    /* -------- AQI -------- */
                    const coords = await getCoordinates(city);
                    const aqi = await getAQI(coords.lat, coords.lon);
                    document.getElementById("aqiNow").innerText = aqi;

                    loadAQI(city);

                } catch (error) {
                    console.error("Error loading weather:", error);
                }
            }


            function drawCharts(data) {

                /* Temperature Line */
                {
                    const { g, width, height } = base("#lineChart");
                    const x = d3.scalePoint().domain(data.map(d => d.day)).range([0, width]);
                    const y = d3.scaleLinear().domain([0, d3.max(data, d => d.temp) + 5]).range([height, 0]);

                    g.append("g").attr("transform", `translate(0,${height})`)
                        .call(d3.axisBottom(x)).attr("class", "axis");
                    g.append("g").call(d3.axisLeft(y)).attr("class", "axis");

                    const line = d3.line()
                        .x(d => x(d.day))
                        .y(d => y(d.temp))
                        .curve(d3.curveMonotoneX);

                    g.append("path")
                        .datum(data)
                        .attr("fill", "none")
                        .attr("stroke", "#ff4d4d")
                        .attr("stroke-width", 3)
                        .attr("d", line);

                    g.selectAll("circle")
                        .data(data)
                        .enter().append("circle")
                        .attr("cx", d => x(d.day))
                        .attr("cy", d => y(d.temp))
                        .attr("r", 4)
                        .attr("fill", "#ff4d4d")
                        .on("mouseover", (e, d) => showTip(e, `Temp: ${d.temp}¬∞C`))
                        .on("mouseout", hideTip);
                }

                /* Temperature Bar */
                {
                    const { g, width, height } = base("#barChart");
                    const x = d3.scaleBand().domain(data.map(d => d.day)).range([0, width]).padding(0.3);
                    const y = d3.scaleLinear().domain([0, d3.max(data, d => d.temp) + 5]).range([height, 0]);

                    g.append("g").attr("transform", `translate(0,${height})`)
                        .call(d3.axisBottom(x)).attr("class", "axis");
                    g.append("g").call(d3.axisLeft(y)).attr("class", "axis");

                    g.selectAll("rect")
                        .data(data)
                        .enter().append("rect")
                        .attr("x", d => x(d.day))
                        .attr("y", d => y(d.temp))
                        .attr("width", x.bandwidth())
                        .attr("height", d => height - y(d.temp))
                        .attr("fill", "#ffa500");
                }

                /* Humidity Area */
                {
                    const { g, width, height } = base("#areaChart");
                    const x = d3.scalePoint().domain(data.map(d => d.day)).range([0, width]);
                    const y = d3.scaleLinear().domain([0, 100]).range([height, 0]);

                    g.append("g").attr("transform", `translate(0,${height})`)
                        .call(d3.axisBottom(x)).attr("class", "axis");
                    g.append("g").call(d3.axisLeft(y)).attr("class", "axis");

                    const area = d3.area()
                        .x(d => x(d.day))
                        .y0(height)
                        .y1(d => y(d.humidity));

                    g.append("path")
                        .datum(data)
                        .attr("fill", "#3399ff")
                        .attr("opacity", 0.6)
                        .attr("d", area);
                }

                /* Rain */
                {
                    const { g, width, height } = base("#rainChart");
                    const x = d3.scaleBand().domain(data.map(d => d.day)).range([0, width]).padding(0.3);
                    const y = d3.scaleLinear().domain([0, d3.max(data, d => d.rain) + 5]).range([height, 0]);

                    g.append("g").attr("transform", `translate(0,${height})`)
                        .call(d3.axisBottom(x)).attr("class", "axis");
                    g.append("g").call(d3.axisLeft(y)).attr("class", "axis");

                    g.selectAll("rect")
                        .data(data)
                        .enter().append("rect")
                        .attr("x", d => x(d.day))
                        .attr("y", d => y(d.rain))
                        .attr("width", x.bandwidth())
                        .attr("height", d => height - y(d.rain))
                        .attr("fill", "#00cc66");
                }

                /* Wind */
                {
                    const { g, width, height } = base("#windChart");
                    const x = d3.scalePoint().domain(data.map(d => d.day)).range([0, width]);
                    const y = d3.scaleLinear().domain([0, d3.max(data, d => d.wind) + 3]).range([height, 0]);

                    g.append("g").attr("transform", `translate(0,${height})`)
                        .call(d3.axisBottom(x)).attr("class", "axis");
                    g.append("g").call(d3.axisLeft(y)).attr("class", "axis");

                    const line = d3.line()
                        .x(d => x(d.day))
                        .y(d => y(d.wind))
                        .curve(d3.curveMonotoneX);

                    g.append("path")
                        .datum(data)
                        .attr("fill", "none")
                        .attr("stroke", "#4facfe")
                        .attr("stroke-width", 3)
                        .attr("d", line);
                }
            }

            /* Load default city */
            loadWeather();

        });
    </script>

</body>

</html>